var $=jQuery.noConflict();bro_ajax_comments={comment_text_area:"textarea#comment, .trumbowyg-editor",ajax_form_data:$("#commentform").serialize(),run:function(){var e=this;e.comment_submit("#commentform"),e.reply(),e.auto_reply(),$(window).on("hashchange",function(){e.auto_reply()}),e.save_in_local_storge(),e.scrill_to_comment_article(),$(window).on("bro_ajax_comments_beforeSubmitForm",function(){e.set_ajax_form_data()})},set_ajax_form_data:function(){this.ajax_form_data=$("#commentform").serialize()},save_in_local_storge:function(){$("#commentform").sisyphus({customKeySuffix:"bro_ajax_comments_",locationBased:!1,excludeFields:$("#_wp_unfiltered_html_comment_disabled , #comment_post_ID , #comment_parent"),timeout:2,autoRelease:!0})},comment_submit:function(e){this.ajax_submit("#commentform"),$(e).keydown(function(t){t.altKey&&13===t.keyCode&&$(e).trigger("submit")})},form_detach:function(e){var t=$("#respond").detach();return t.find("#comment_parent").val(e),t},reply:function(){var e=this;$(".comment-reply-link").on("click",function(){$(window).trigger("bro_ajax_comments_reply_before");var t=JSON.parse($(this).attr("data-reply-info")),o=t.comment_ID;$(e.form_detach(o)).appendTo("#article-comment-"+t.comment_ID),$(window).trigger("bro_ajax_comments_reply_after")})},auto_reply:function(){var e=window.location.hash;""!==e&&e.indexOf("#article-comment-")+1&&$("[href='"+e+"']").click()},ajax_submit:function(e){var t=this;$(e).attr("action",bro_ajax_comments_data.form_action),$(e).find("[type='submit']").removeAttr("disabled"),$(e).hasClass("load")||($(window).trigger("bro_ajax_comments_beforeSubmitForm"),$(e).submit(function(o){o.preventDefault(),t.set_ajax_form_data();var a=$(this).attr("method"),n=$(this).attr("action"),r=$(this),m=t.ajax_form_data;console.log(m),$.ajax({type:a,url:n,data:m,beforeSend:function(e,t){$(window).trigger("bro_ajax_comments_beforeSend",{data:[e,t]}),r.addClass("load"),r.find("[type='submit']").attr("disabled","disabled")},success:function(o){if($(".bro_ajax_comments__exceptions-message").remove(),o.hasOwnProperty("exceptions"))o.hasOwnProperty("exception_code")?($(t.comment_text_area).removeClass("empty"),403===o.exception_code||200===o.exception_code?$(window).trigger("bro_ajax_comments_error",{type:"no-login",data:[o]}):411===o.exception_code&&$(t.comment_text_area).addClass("empty")):$(e).prepend(o.html_exceptions);else if(void 0!==o.html&&void 0!==o.comment){var a=o.html,n=o.comment;r.closest(".comment__article-wrap").length?$("#comment-wrap-"+n.comment_parent).after(a):$("#respond").before(a),r.trigger("reset")}$(window).trigger("bro_ajax_comments_success",o)},complete:function(e,o){if("success"===o&&void 0!==e&&!e.responseJSON.hasOwnProperty("exceptions")){var a=e.responseJSON.comment.comment_ID;$(t.form_detach(a)).appendTo("#article-comment-"+a),$(window).trigger("bro_ajax_comments_add_comment",{data:[e,o]})}$(window).trigger("bro_ajax_comments_complete",{data:[e,o]}),r.find("[type='submit']").removeAttr("disabled"),r.removeClass("load")}})}))},scrill_to_comment_article:function(){$(window).on("bro_ajax_comments_complete",function(e,t){var o=t.data[0].responseJSON;if(!o.hasOwnProperty("exceptions")){var a=o.comment.comment_ID,n=$("#comment-wrap-"+a).offset().top;$.browser.safari?$("body").animate({scrollTop:n},900):$("html").animate({scrollTop:n},900)}})},preloader:function(){var e,t=$("#submit").text();$(window).on("bro_ajax_comments_beforeSend",function(){var o="";e=setInterval(function(){o+=".",$("#submit").text(t+o),o.length>=3&&(o="")},1e3)}),$(window).on("bro_ajax_comments_complete",function(){clearInterval(e),$("#submit").text(t)})}},$(document).ready(function(){bro_ajax_comments.run()});