describe("Sisyphus",function(){var t,e,a;beforeEach(function(){loadFixtures("fixtures.html"),t=Sisyphus.getInstance(),t.setOptions({}),e=$("#form1"),a=$("#named"),t.protect(e)}),afterEach(function(){t=Sisyphus.free()}),it("should return an object on instantiating",function(){var t=Sisyphus.getInstance();expect(typeof t).toEqual("object")}),it("should return null on freeing",function(){t=Sisyphus.free(),expect(t).toEqual(null)}),it("should return the same instance",function(){var t=Sisyphus.getInstance(),e=Sisyphus.getInstance();expect(t).toEqual(e)}),it("should have instances with common options, i.e. be a Singleton",function(){var t=Sisyphus.getInstance(),e=Sisyphus.getInstance();t.setOptions({timeout:5}),e.setOptions({timeout:15}),expect(t.options).toEqual(e.options)}),it("should return false if Local Storage is unavailable",function(){spyOn(t.browserStorage,"isAvailable").andCallFake(function(){return!1}),expect(t.protect(e)).toEqual(!1)}),it("should bind saving data only once",function(){t=Sisyphus.free(),t=Sisyphus.getInstance(),spyOn(t,"bindSaveData"),t.protect("form"),expect(t.bindSaveData.callCount).toEqual(1)}),it("should bind saving data only once - if new call is done it should just add new targets to protect",function(){
// #form1 is already being protected from 'beforeEach' method
spyOn(t,"bindSaveData"),t.protect($("#form2")),expect(t.bindSaveData.callCount).toEqual(0)}),it("if new call is done it should just add new targets to protect",function(){
// #form1 is already being protected from 'beforeEach' method
var e,a=t.targets.length;t.protect($("#form2")),e=t.targets.length,expect(a).toBeLessThan(e)}),it("should allow a custom name for the form",function(){t=Sisyphus.getInstance(),t.setOptions({name:"something"}),t.protect(a),expect(t.href).toEqual("something")}),it("should not protect the same form twice and more times",function(){
// #form1 is already being protected from 'beforeEach' method
var e,a=t.targets.length;t.protect($("#form1")),t.protect($("#form1")),e=t.targets.length,expect(a).toEqual(e)}),it("should save textfield data on key input, if options.timeout is not set",function(){spyOn(t,"saveToBrowserStorage"),$(":text:first",e).trigger("oninput"),expect(t.saveToBrowserStorage).toHaveBeenCalled()}),it("should not save all data, but textfield only on key input, if options.timeout is not set",function(){spyOn(t,"saveAllData"),$(":text:first",e).trigger("oninput"),expect(t.saveAllData.callCount).toEqual(0)}),it("should save textarea data on key input, if options.timeout is not set",function(){spyOn(t,"saveToBrowserStorage"),$("textarea:first",e).trigger("oninput"),expect(t.saveToBrowserStorage).toHaveBeenCalled()}),it("should not save all data, but textarea only on key input, if options.timeout is not set",function(){spyOn(t,"saveAllData"),$("textarea:first",e).trigger("oninput"),expect(t.saveAllData.callCount).toEqual(0)}),it("should save all data on checkbox change",function(){spyOn(t,"saveAllData"),$(":checkbox:first",e).trigger("change"),expect(t.saveAllData).toHaveBeenCalled()}),it("should save all data on radio change",function(){spyOn(t,"saveAllData"),$(":radio:first",e).trigger("change"),expect(t.saveAllData).toHaveBeenCalled()}),it("should save all data on select change",function(){spyOn(t,"saveAllData"),$("select:first",e).trigger("change"),expect(t.saveAllData).toHaveBeenCalled()}),it("should fire callback once on saving all data to Local Storage",function(){spyOn(t.options,"onSave"),t.saveAllData(),expect(t.options.onSave.callCount).toEqual(1)}),it("should fire callback on saving data to Local Storage",function(){spyOn(t.options,"onSave"),t.saveToBrowserStorage("key","value"),expect(t.options.onSave).toHaveBeenCalled()}),it("should fire callback on removing data from Local Storage",function(){spyOn(t.options,"onRelease"),t.releaseData(e.attr("id"),e.find(":text")),expect(t.options.onRelease).toHaveBeenCalled()}),it("should fire callback on restoring data from Local Storage",function(){spyOn(t.options,"onRestore"),t.restoreAllData(),expect(t.options.onRestore).toHaveBeenCalled()}),it("should not store excluded fields data",function(){t.setOptions({excludeFields:$("textarea:first")}),$("textarea:first").val("should not store"),t.saveAllData(),$("textarea:first").val(""),t.restoreAllData(),expect($("textarea:first").val()).toEqual("")})}),describe("jQuery.sisyphus",function(){beforeEach(function(){loadFixtures("fixtures.html")}),it("should return a Sisyphus instance",function(){var t=$("#form1"),e="[id="+t.attr("id")+"][name="+t.attr("name")+"]",a=$("#form1").sisyphus(),o=Sisyphus.getInstance(e);expect(a).toEqual(o)}),it("should set the custom name on the Sisyphus instance",function(){Sisyphus.free();var t=$(" #named").sisyphus({name:"custom-name"});sisyphus=Sisyphus.getInstance(),expect(t.href).toEqual("custom-name")}),it("should protect matched forms with Sisyphus",function(){var t=$("#form1"),e="[id="+t.attr("id")+"][name="+t.attr("name")+"]";spyOn(Sisyphus.getInstance(e),"protect"),$("#form1").sisyphus(),expect(Sisyphus.getInstance(e).protect).toHaveBeenCalled()})});